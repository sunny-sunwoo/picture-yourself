
<!-- START SIGMA IMPORTS -->
<script src="../src/sigma.core.js"></script>
<script src="../src/conrad.js"></script>
<script src="../src/utils/sigma.utils.js"></script>
<script src="../src/utils/sigma.polyfills.js"></script>
<script src="../src/sigma.settings.js"></script>
<script src="../src/classes/sigma.classes.dispatcher.js"></script>
<script src="../src/classes/sigma.classes.configurable.js"></script>
<script src="../src/classes/sigma.classes.graph.js"></script>
<script src="../src/classes/sigma.classes.camera.js"></script>
<script src="../src/classes/sigma.classes.quad.js"></script>
<script src="../src/classes/sigma.classes.edgequad.js"></script>
<script src="../src/captors/sigma.captors.kinect.js"></script>
<script src="../src/captors/sigma.captors.mouse.js"></script>
<script src="../src/captors/sigma.captors.touch.js"></script>
<script src="../src/renderers/sigma.renderers.canvas.js"></script>
<script src="../src/renderers/sigma.renderers.webgl.js"></script>
<script src="../src/renderers/sigma.renderers.svg.js"></script>
<script src="../src/renderers/sigma.renderers.def.js"></script>
<script src="../src/renderers/webgl/sigma.webgl.nodes.def.js"></script>
<script src="../src/renderers/webgl/sigma.webgl.nodes.fast.js"></script>
<script src="../src/renderers/webgl/sigma.webgl.edges.def.js"></script>
<script src="../src/renderers/webgl/sigma.webgl.edges.fast.js"></script>
<script src="../src/renderers/webgl/sigma.webgl.edges.arrow.js"></script>
<!--script src="../src/renderers/canvas/sigma.canvas.labels.def.js"></script-->
<script src="../src/renderers/canvas/sigma.canvas.hovers.def.js"></script>
<script src="../src/renderers/canvas/sigma.canvas.nodes.def.js"></script>
<script src="../src/renderers/canvas/sigma.canvas.edges.def.js"></script>
<script src="../src/renderers/canvas/sigma.canvas.edges.curve.js"></script>
<script src="../src/renderers/canvas/sigma.canvas.edges.arrow.js"></script>
<script src="../src/renderers/canvas/sigma.canvas.edges.curvedArrow.js"></script>
<script src="../src/renderers/canvas/sigma.canvas.edgehovers.def.js"></script>
<script src="../src/renderers/canvas/sigma.canvas.edgehovers.curve.js"></script>
<script src="../src/renderers/canvas/sigma.canvas.edgehovers.arrow.js"></script>
<script src="../src/renderers/canvas/sigma.canvas.edgehovers.curvedArrow.js"></script>
<script src="../src/renderers/canvas/sigma.canvas.extremities.def.js"></script>
<script src="../src/renderers/svg/sigma.svg.utils.js"></script>
<script src="../src/renderers/svg/sigma.svg.nodes.def.js"></script>
<script src="../src/renderers/svg/sigma.svg.edges.def.js"></script>
<script src="../src/renderers/svg/sigma.svg.edges.curve.js"></script>
<script src="../src/renderers/svg/sigma.svg.labels.def.js"></script>
<script src="../src/renderers/svg/sigma.svg.hovers.def.js"></script>
<script src="../src/middlewares/sigma.middlewares.rescale.js"></script>
<script src="../src/middlewares/sigma.middlewares.copy.js"></script>
<script src="../src/misc/sigma.misc.animation.js"></script>
<script src="../src/misc/sigma.misc.bindEvents.js"></script>
<script src="../src/misc/sigma.misc.bindDOMEvents.js"></script>
<script src="../src/misc/sigma.misc.drawHovers.js"></script>
<!-- END SIGMA IMPORTS -->
<script src="../plugins/sigma.parsers.json/sigma.parsers.json.js"></script>
<script src="../plugins/sigma.plugins.filter/sigma.plugins.filter.js"></script>
<link href='http://fonts.googleapis.com/css?family=Lato:300,700' rel='stylesheet' type='text/css'>
<script src="../plugins/sigma.plugins.animate/sigma.plugins.animate.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="../src/socket.io-client.min.js"></script>
<script src="../plugins/sigma.layout.forceAtlas2/worker.js"></script>
<script src="../plugins/sigma.layout.forceAtlas2/supervisor.js"></script>
<script src="../plugins/sigma.layout.noverlap/sigma.layout.noverlap.js"></script>
<!-- MOSAIC GENERATOR -->
<script src="mosaic/libraries/p5.js"></script>
<script src="mosaic/libraries/p5.dom.js"></script>
<script src="mosaic/libraries/p5.sound.js"></script>
<script src="mosaic/sketch.js" defer></script>
<!-- <script src="https://cdn.socket.io/socket.io-1.3.5.js"></script> -->


<div id="container">
  <style>
    body {
      color: #333;
      background-color: RGBA(177, 150, 148, 0.05);
      background-image: radial-gradient( RGBA(177, 150, 148, 0.05), RGBA(177, 150, 148, 0.50));
      font-size: 14px;
      font-family: Lato, sans-serif;
    }
    #target-img {
      display: none;
      -webkit-clip-path: circle(50px at center); 
      clip-path: circle(50px at center);
       
      width: 100px;
      overflow: hidden;
    
      position: absolute;

    }
    .big {
    animation-name: example;
    animation-duration: 4s;
    }


    @keyframes example {
        0%   {transform: scale(1.5,1.5);}
        10%  {transform: scale(0.6, 0.6);}
        25%  {transform: scale(2.5,2.5);}
        50%  {transform: scale(1,1);}
        75%  {transform: scale(2,2);}
        100% {transform: scale(0.5,0.5);}
    }
    #message-div {
      background-color: RGBA(255, 255, 255, 0.8);
      padding-left: 30px;
      padding-right: 30px;
      bottom: 0;
      right: 0;
      position: absolute;
      margin-bottom: 10%;
      margin-right: 15%;
      font-size: 1.5em;
      line-height: 1.5;
      opacity: 0;
    }

    #graph-container {
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
      position: absolute;
      opacity: 1;
    }
    #graph-container img {
      -webkit-filter: grayscale(100%);
      -webkit-filter: grayscale(1);
      filter: grayscale(100%);
    }
    #control-pane {
      display: none;
      top: 10px;
      /*bottom: 10px;*/
      right: 10px;
      position: absolute;
      width: 230px;
      background-color: rgb(249, 247, 237);
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }
    #control-pane > div {
      margin: 10px;
      overflow-x: auto;
    }
    .line {
      clear: both;
      display: block;
      width: 100%;
      margin: 0;
      padding: 12px 0 0 0;
      border-bottom: 1px solid #aac789;
      background: transparent;
    }
    h2, h3, h4 {
      padding: 0;
      font-variant: small-caps;
    }
    .green {
      color: #437356;
    }
    h2.underline {
      color: #437356;
      background: #f4f0e4;
      margin: 0;
      border-radius: 2px;
      padding: 8px 12px;
      font-weight: 700;
    }
    .hidden {
      display: none;
      visibility: hidden;
    }

    input[type=range] {
      width: 160px;
    }

    .main {
        display: flex;
        padding: 2em;
        height: 90vh;
        justify-content: center;
        align-items: middle;
    }
    
    .mid-circle {
      fill: rgb(255, 0, 0);
    }

    .clockbox,
    #clock {
        height: 100%;
    }

    #hour {
        transform-origin: 600px 600px;
        /*transition: transform .1s;*/
    }
  </style>
  
  <div id="graph-container"></div>
  <img src="./src/img/img2.png" id="target-img">
  <div id="control-pane">
    <h2 class="underline">filters</h2>
    <div>
      <button id="click-transition">Transition</button>
      <button id="click-disappear">Disappear</button>
      <button id="click-appear">Appear</button>
      <button id="click-change">Change</button>
      <button id="click-animation">Animation</button>
      <h3>min degree <span id="min-degree-val">0</span></h3>
      0 <input id="min-degree" type="range" min="0" max="0" value="0"> <span id="max-degree-value">0</span><br>
    </div>
    
    <span class="line"></span>
    
    <div id="dump" class="hidden"></div>
  </div>
  <div id="message-div">
    <!--p id="message">Welcome to ETC!<br>You're <span id="visit-num">1st</span> visitor today<br>2018. 11. 04</p-->
  </div>
  <!-- <main class="main">
    <div class="clockbox">
      <svg id="clock" xmlns="http://www.w3.org/2000/svg" width="1200" height="1200" viewBox="0 0 1200 1200">
        <g id="hour">
          <circle class="mid-circle" cx="600" cy="600" r="16.2"/>
        </g>
      </svg>
    </div>
  </main> -->
</div>


<script>

/**
 * This is an example on how to use sigma filters plugin on a real-world graph.
 */
var filter;

/**
 * DOM utility functions
 */
var _ = {
  $: function (id) {
    return document.getElementById(id);
  },

  all: function (selectors) {
    return document.querySelectorAll(selectors);
  },

  removeClass: function(selectors, cssClass) {
    var nodes = document.querySelectorAll(selectors);
    var l = nodes.length;
    for ( i = 0 ; i < l; i++ ) {
      var el = nodes[i];
      // Bootstrap compatibility
      el.className = el.className.replace(cssClass, '');
    }
  },

  addClass: function (selectors, cssClass) {
    var nodes = document.querySelectorAll(selectors);
    var l = nodes.length;
    for ( i = 0 ; i < l; i++ ) {
      var el = nodes[i];
      // Bootstrap compatibility
      if (-1 == el.className.indexOf(cssClass)) {
        el.className += ' ' + cssClass;
      }
    }
  },

  show: function (selectors) {
    this.removeClass(selectors, 'hidden');
  },

  hide: function (selectors) {
    this.addClass(selectors, 'hidden');
  },

  toggle: function (selectors, cssClass) {
    var cssClass = cssClass || "hidden";
    var nodes = document.querySelectorAll(selectors);
    var l = nodes.length;
    for ( i = 0 ; i < l; i++ ) {
      var el = nodes[i];
      //el.style.display = (el.style.display != 'none' ? 'none' : '' );
      // Bootstrap compatibility
      if (-1 !== el.className.indexOf(cssClass)) {
        el.className = el.className.replace(cssClass, '');
      } else {
        el.className += ' ' + cssClass;
      }
    }
  }
};


function updatePane (graph, filter) {
  // get max degree
  var maxDegree = 0,
      categories = {};
  
  // read nodes
  graph.nodes().forEach(function(n) {
    maxDegree = Math.max(maxDegree, graph.degree(n.id));
  })

  // min degree
  _.$('min-degree').max = maxDegree;

  _.$('max-degree-value').textContent = maxDegree;
  
}

sigma.utils.pkg('sigma.canvas.nodes');
sigma.canvas.nodes.image = (function() {
  var _cache = {},
      _loading = {},
      _callbacks = {};

  // Return the renderer itself:
  var renderer = function(node, context, settings) {

    var args = arguments,
        prefix = settings('prefix') || '',
        size = node[prefix + 'size'],
        color = node.color || settings('defaultNodeColor'),
        url = node.url;

    if (_cache[url]) {

      context.save();

      // Draw the clipping disc:
      context.beginPath();
      context.arc(
        node[prefix + 'x'],
        node[prefix + 'y'],
        node[prefix + 'size'],
        0,
        Math.PI * 2,
        true
      );
      context.closePath();
      context.clip();

      // Draw the image
      context.drawImage(
        _cache[url],
        node[prefix + 'x'] - size,
        node[prefix + 'y'] - size,
        2 * size,
        2 * size
      );

      //grayscale 
      //grayScale(context);

      // Quit the "clipping mode":
      context.restore();


      // Draw the border:
      context.beginPath();
      context.arc(
        node[prefix + 'x'],
        node[prefix + 'y'],
        node[prefix + 'size'],
        0,
        Math.PI * 2,
        true
      );
      context.lineWidth = size / 20;
      context.strokeStyle = node.color  || settings('defaultNodeColor');
      context.stroke();

    } else {

      sigma.canvas.nodes.image.cache(url);
      sigma.canvas.nodes.def.apply(
        sigma.canvas.nodes,
        args
      );
    }
  };




  // Let's add a public method to cache images, to make it possible to
  // preload images before the initial rendering:
  renderer.cache = function(url, callback) {

    if (callback)
      _callbacks[url] = callback;

    if (_loading[url])
      return;

    var img = new Image();
    img.onload = function() {
      
      _loading[url] = false;
      _cache[url] = img;

      if (_callbacks[url]) {
        _callbacks[url].call(this, img);
        delete _callbacks[url];
      }
    };

    _loading[url] = true;
    img.src = url;
  };

  return renderer;
})();

var i,
    s,
    o,
    C = 100, //node random
    d = 0.5,
    cs = [],
    g = {
      nodes: [],
      edges: []
    },
    loaded = 0;

s = new sigma({
  //graph: g,
  renderer: {
    container: document.getElementById('graph-container'),
    type: 'canvas'
  },
  settings: {
    //edgeColor: '#B50A0D',
    //defaultEdgeColor: '#9A9A9A',
    //defaultNodeColor: '#666666',
    animationsTime: 2000,
    drawEdges: true,
    minNodeSize: 6,
    maxNodeSize: 17,
    minEdgeSize: 0.1,
    maxEdgeSize: 3,
    labelSizeRatio: 30,
    labelColor: '#B50A0D',
    labelThreshold: 25,
    font: "Lato"
  }
});

sigma.parsers.json('data-random.json', s, function (s) {

  filter = new sigma.plugins.filter(s);
  updatePane(s.graph, filter); // updating UI 
 
  function applyMinDegreeFilter(e) {
    var v = e.target.value; // input value of scroller
    _.$('min-degree-val').textContent = v;
    _.$('min-degree-val').value = v;

    filter
      .undo('min-degree')
      .nodesBy(function(n) {
        return this.degree(n.id) >= v;
      }, 'min-degree')
      .apply();
  }

  _.$('min-degree').addEventListener("input", applyMinDegreeFilter);  // for Chrome and FF
  _.$('min-degree').addEventListener("change", applyMinDegreeFilter); // 
  //s.startForceAtlas2({worker: true, barnesHutOptimize: false});
  
    // Configure the noverlap layout:
  /*var noverlapListener = s.configNoverlap({
    nodees: s.graph.nodes(),
    nodeMargin: 1,
    scaleNodes: 1.05,
    gridSize: 75,
    easing: 'quadraticInOut', // animation transition function
    duration: 1000   // animation duration. Long here for the purposes of this example only
  });
  // Bind the events:
  noverlapListener.bind('start stop interpolate', function(e) {
    console.log(e.type);
    console.log(s.isNoverlapRunning());
    if(e.type === 'start') {
      console.time('noverlap');
    }
    if(e.type === 'interpolate') {
      console.timeEnd('noverlap');
    }
  });

    // Start the layout:

      s.startNoverlap(); */
});


/*s.startForceAtlas2();
  s.configForceAtlas2({worker: true, barnesHutOptimize: false, slowDown: 1, scalingRatio: 1, edgeWeightInfluence: 0.8, gravity: 0});*/
//sigma.parsers.json('data.json', s.graph);

function initialJSON(jsonInput) {
  s.graph.clear();
  s.graph.read(jsonInput);
}

var newSrc;

var description = "";
var countryMessage = "";


function getString(newCountry, newInterest) {
  console.log(newCountry +", " + newInterest);
  countryMessage = newCountry;
  switch(newInterest) {
      case "FineArts":
          description = "CMU’s College of Fine Arts is one of the most respected research universities offering convergence of contemporary art, technology, and critical discourse." ;
          break;
      case "Humanities":
          description = "CMU’s Dietrich College of Humanities is home to students who can solve real-world problems and contribute in traditional ways." ;
          break;
      case "InformationSystems":
          description = "CMU’s Heinz College is a interdisciplinary program for next generation of leaders who can connect People, policy, and technology.";
          break;
      case "Science":
          description = "CMU’s Mellon College of Science is a dynamic, collaborative college for innovators and forward-thinkers.";
          break;
      case "Engineering":
          description = "CMU's world-class College of Engineering is renowned for its excellence, innovation, and the societal relevance of its pursuits.";
          break;
      case "Entertainment":
          description = "CMU’s Entertainment Technology Center is the premiere graduate program for interactive entertainment.";
          break;
      case "PublicPolicy":
          description = "CMU’s Heinz College is a interdisciplinary program for next generation of leaders who can connect People, policy, and technology.";
          break;
      case "Business":
          description = "CMU’s Tepper School is one of the strongest and most innovative business schools in the world.";
          break;
      case "ComputerScience":
          description = "CMU’s SCS is one of the best computer science programs in the world leading many facets of computer science and robotics education.";
          break;
      default:
          description = "Welcome to Carnegie Mellon University!";
          break;
  }
}

var newGraph2;
var newGraph1;

function getJSON(jsonInput1, jsonInput2, newUrl) {
  // console.log(jsonInput);
  newSrc = newUrl;
  newGraph1 = jsonInput1;
  newGraph2 = jsonInput2;
 
  s.graph.clear();
  s.graph.read(newGraph1);
  $("#target-img").attr("src",newSrc);
  
  //render the animation
  myAnimation_1(s.graph, 'random1_', 'q1_');
  setTimeout( function(){myAnimation_2(s.graph,'random2_', 'q2_')},23000);
  }
function grayScale(context) {
    var imgData = context.getImageData(0, 0, 500, 500);
        var pixels  = imgData.data;
        for (var i = 0, n = pixels.length; i < n; i += 4) {
        var grayscale = pixels[i] * .3 + pixels[i+1] * .59 + pixels[i+2] * .11;
        pixels[i  ] = grayscale;        // red
        pixels[i+1] = grayscale;        // green
        pixels[i+2] = grayscale;        // blue
        //pixels[i+3]              is alpha
    }
    //redraw the image in black & white
    context.putImageData(imgData, 0, 0);
  }
var m_ = document.createElement('P');
  
   
function myMessageIn(){
  var opacityDegree = 0;
  m_.innerHTML = "Welcome to CMU. <br> You're 11th person from " + countryMessage + " today";
  _.$('message-div').appendChild(m_);
    var i = setInterval(function(){
    if(opacityDegree >= 0.99){
      _.$('message-div').style.opacity = 1;
      clearInterval(i);
    } else {
      opacityDegree += 0.01;
      _.$('message-div').style.opacity =  opacityDegree;
      // console.log("message in");
    }
  }, 10);
}

function myMessageOut(){
  opacityDegree = 1;
  
    var j = setInterval(function(){
    if(opacityDegree <= 0.05){
      _.$('message-div').style.opacity = 0;
      _.$('message-div').removeChild(m_);
      clearInterval(j);
    } else {
      opacityDegree -= 0.01;
      _.$('message-div').style.opacity =  opacityDegree;
      // console.log("message out");
    }
  }, 10);
}
var dc_ = document.createElement('P');

console.log(111, dc_.innerHTML);
   
function myDescriptionIn(){
  var opacityDegree = 0;
  dc_.innerHTML = description;
  console.log("des" +description);

  console.log("dc" + dc_.innerHTML);
  _.$('message-div').appendChild(dc_);
    var i = setInterval(function(){
    if(opacityDegree >= 0.99){
      _.$('message-div').style.opacity = 1;
      clearInterval(i);
    } else {
      opacityDegree += 0.01;
      _.$('message-div').style.opacity =  opacityDegree;
      // console.log("message in");
    }
  }, 10);
}
function myDescriptionOut(){
  opacityDegree = 1;
     
    var j = setInterval(function(){
    if(opacityDegree <= 0.05){
      _.$('message-div').style.opacity = 0;
      _.$('message-div').removeChild(dc_);
      clearInterval(j);
    } else {
      opacityDegree -= 0.01;
      _.$('message-div').style.opacity =  opacityDegree;
      // console.log("message out");
    }
  }, 10);
}

function myTransition(before, after){
 // s.stopForceAtlas2();
  var step = 0;
  var transition = setInterval(function() {
    var prefix = [after, before][step = +!step];
    sigma.plugins.animate(
      s,
      {
        x: prefix + 'x',
        y: prefix + 'y'
      }
    );
  }, 1000);

  /*var nodes = s.graph.nodes();
  var after_x = after + 'x';
  var after_y = after + 'y';
  nodes[100].x = 123;

  nodes.forEach( function(node) {
    
    node.x = node[after_x];
    node.y = node[after_y];
    
  });*/

  setTimeout ( function() {clearInterval(transition);}, 2000);
  //s.startForceAtlas2();
}




function myDefault(){
  console.log("default");
  _.$('graph-container').style.opacity = 1;
}


function myAppear(graph) {
  var maxDegree = 0;
  // console.log("appear");
  graph.nodes().forEach(function(n) {
    maxDegree = Math.max(maxDegree, graph.degree(n.id));
  })
  
  _.$('min-degree').max = maxDegree;
  
  var v = maxDegree; 
  _.$('graph-container').style.opacity = 0;
  var opacityDegree = 0;
  var opacityAnim = setInterval(function(){
    if(opacityDegree >= 0.99){
      _.$('graph-container').style.opacity = 1;
      clearInterval(opacityAnim);
    } else {
      opacityDegree += 0.01;
      _.$('graph-container').style.opacity =  opacityDegree;
    }
  }, 20);

  var interval = setInterval(frame, 200);
    function frame(){
      if( v == 0){
        clearInterval(interval);
      } else {
        v -= 0.5;
        filter
          .undo('min-degree')
          .nodesBy(function(n) {
            return this.degree(n.id) >= v;
          }, 'min-degree')
          .apply();
      }
    }
  }
  function myDisappear(graph) {
  var maxDegree = 0;
  // console.log("disappear");
  graph.nodes().forEach(function(n) {
    maxDegree = Math.max(maxDegree, graph.degree(n.id));
  })
  
  var opacityDegree = 1;
  var opacityAnim = setInterval(function(){
    if(opacityDegree <= 0.05){
      _.$('graph-container').style.opacity = 0;
      clearInterval(opacityAnim);
    } else {
      opacityDegree -= 0.01;
      _.$('graph-container').style.opacity =  opacityDegree;
          }
  }, 20);


  _.$('min-degree').max = maxDegree;
  var v = 0; 
  var interval = setInterval(frame, 200);
    function frame(){
      if( v == maxDegree){
        clearInterval(interval);
        
      } else {
        v += 0.5;
        filter
          .undo('min-degree')
          .nodesBy(function(n) {
            return this.degree(n.id) >= v;
          }, 'min-degree')
          .apply();
      }
    }

  }
  var appearAnim;
  var newAnim;
  var transAnim_1;
  var transAnim_2;
  var messageAnim_1;
  var messageAnim_2;
  var disappearAnim;

  function myAnimation_1(graph, before, after){
	    window.dispatchEvent(new Event("show_picture"));
      // console.log("hey");
      appearAnim = setTimeout( function() {myAppear(graph)},  0);
      newAnim = setTimeout( myNew, 4000);
      transAnim_1 = setTimeout( function() {myTransition(before, after)}, 4500);
      messageAnim_1 = setTimeout( myMessageIn, 5000);
      messageAnim_2 = setTimeout( myMessageOut, 20000);
      disappearAnim = setTimeout( function() {myDisappear(graph)}, 18000);
      transAnim_2 = setTimeout( function() {myTransition(after, before)}, 10000);
      //setTimeout( function() {myTransition(before, after)}, 18000);
      //setTimeout( function() {myTransition(after, before)}, 35000);
      console.log("before second animation");
      
  }

  function myAnimation_2(graph, before, after){
      clearTimeout(appearAnim);
      clearTimeout(newAnim);
      clearTimeout(transAnim_1);
      clearTimeout(transAnim_2);
      clearTimeout(messageAnim_1);
      clearTimeout(messageAnim_2);
      clearTimeout(disappearAnim);
      myDefault();
      
      console.log("start animation2");
      graph.clear();
      graph.read(newGraph2);
      myNew();
      console.log("new graph");
      setTimeout( function() {myAppear(graph)},  0);
      setTimeout( myDescriptionIn, 0);
      setTimeout( function() {myTransition(before, after)}, 5000);
      setTimeout( myDescriptionOut, 5000);

  }
var currentIndex;
var newBool = true;
  function myNewPop(){
    $("#target-img").addClass("big").css({"display": "initial"});
  }
  function myNew(){
      var currentNodes = s.graph.nodes(); 
     currentNodes[currentIndex].color ='#B50A0D';
     currentNodes[currentIndex].label = "You're Here!";
     currentNodes[currentIndex].strokeStyle = currentNodes[currentIndex].color;
     if(newBool == true){
     myNewPop();
     newBool = false;
    }
    console.log(currentNodes[currentIndex].label);
    var currentNode = currentNodes[currentIndex];
      
      sigma.utils.pkg('sigma.canvas.labels');

  /**
   * This label renderer will just display the label on the right of the node.
   *
   * @param  {object}                   node     The node object.
   * @param  {CanvasRenderingContext2D} context  The canvas context.
   * @param  {configurable}             settings The settings function.
   */
  sigma.canvas.labels.def = function(currentNode, context, settings) {
    var x,
        y,
        w,
        h,
        e,
        fontStyle = settings('fontStyle'),
        fontSize = (settings('labelSize') === 'fixed') ?
          settings('defaultLabelSize') :
          settings('labelSizeRatio') * size,
        prefix = settings('prefix') || '',
        size = currentNode[prefix + 'size'];

    
    if(currentNode.label == "You're Here!"){
       // Label background:
        /*context.font = (fontStyle ? fontStyle + ' ' : '') +
          fontSize + 'px ' + settings('font');

        context.beginPath();
        context.fillStyle = '#B50A0D';
          x = Math.round(currentNode[prefix + 'x'] - fontSize / 2 + 20);
          y = Math.round(currentNode[prefix + 'y'] - fontSize / 2 - 2);
          w = Math.round(
            context.measureText(currentNode.label).width + fontSize / 2 + size -2
          );
          h = Math.round(fontSize - 15);
          e = Math.round(fontSize / 2 + 15);

          context.moveTo(x, y + e);
          context.lineTo(x + w, y + e);
          context.lineTo(x + w, y + h);
          context.lineTo(x, y + h );
          context.lineTo(x, y + e);
          context.closePath();
          context.fill();
        */
        // Label background:
      context.font = (fontStyle ? fontStyle + ' ' : '') +
        fontSize + 'px ' + (settings('hoverFont') || settings('font'));

      context.beginPath();
      context.fillStyle = '#B50A0D';

      
        x = Math.round(currentNode[prefix + 'x'] - fontSize / 2 - 2);
        y = Math.round(currentNode[prefix + 'y'] - fontSize / 2 - 2);
        w = Math.round(
          context.measureText(currentNode.label).width + fontSize / 2 + size + 7
        );
        h = Math.round(fontSize + 4);
        e = Math.round(fontSize / 2 + 2);

        context.moveTo(x, y + e);
        context.arcTo(x, y, x + e, y, e);
        context.lineTo(x + w, y);
        context.lineTo(x + w, y + h);
        context.lineTo(x + e, y + h);
        context.arcTo(x, y + h, x, y + h - e, e);
        context.lineTo(x, y + e);

        context.closePath();
        context.fill();

        context.shadowOffsetX = 0;
        context.shadowOffsetY = 0;
        context.shadowBlur = 0;
      

       // Node:
    var nodeRenderer = sigma.canvas.nodes[currentNode.type] || sigma.canvas.nodes.def;
    nodeRenderer(currentNode, context, settings);
            
    }else {
      if (size < settings('labelThreshold')){
        return;
      }
    }
    
    if (!currentNode.label || typeof currentNode.label !== 'string')
      return;

    fontSize = (settings('labelSize') === 'fixed') ?
      settings('defaultLabelSize') :
      settings('labelSizeRatio') * size;

    context.font = (settings('fontStyle') ? settings('fontStyle') + ' ' : '') +
      fontSize + 'px ' + settings('font');
    if(currentNode.label =="You're Here!"){
    context.fillStyle = 'white';
    }else{
      context.fillStyle = settings('nodeBorderColor') === 'node' ?
        (node.color || settings('defaultNodeColor')) :
        settings('defaultNodeBorderColor');
    }

    context.fillText(
      currentNode.label,
      Math.round(currentNode[prefix + 'x'] + size + 3),
      Math.round(currentNode[prefix + 'y'] + fontSize / 3)
    );
  };
  }


  



  jQuery.fn.center = function() {
  this.css("position", "absolute");
  this.css("top", ($(window).height() - this.height()) / 2 + $(window).scrollTop() + "px");
  this.css("left", ($(window).width() - this.width()) / 2 + $(window).scrollLeft() + "px");
  return this;
  }

$("#target-img").on('animationend', function(e) { 
    $("#target-img").removeClass("big").css({"display": "none"});
  });

//Center
$("#target-img").center()

//Zoom in / out
$("#click-change").on("click", function() {
  
  $("#target-img").addClass("big").css({"display": "initial"});
});

_.$('click-appear').addEventListener("click", function(){ myAppear(s.graph); });
_.$('click-disappear').addEventListener("click", function(){ myDisappear(s.graph); });
_.$('click-transition').addEventListener("click", function (){myTransition('random_', 'q1_');});
_.$('click-animation').addEventListener("click", function(){myAnimation_1(s.graph, 'random_', 'q1_');});

//_.$('click-change').addEventListener("click", function(){ myChange(s.graph);});

</script>
